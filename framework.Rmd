---
title: "Simulation Framework"
author: "Christian Pascual"
output: html_document
---

```{r, message = F, warning = F }
library(tidyverse)
```


# Doing The Simulations

![](./img/process.png)

```{r}
# Function for creating backbone for data of an N-of-1 trial
create.backbone = function(order = c("A", "B"), s.freq = 1, 
                           p.length = 20, n.blocks = 1) {
  # Assumes that we will only be working with two treatments 
  
  # Parameters
  #   - order: the order that the treatments appear in
  #   - freq: the sampling frequency, how many times a patient will be measured in a 
  #           given treatment period
  #   - n.block: how many treatment blocks there are
  
  # Build out a block skeleton detailing the treatment schedule for the subject
  single.block = tibble(
    treatment = rep(order, each = s.freq * p.length)
  )
  
  # Append this data structure to itself repeatedly
  all.blocks = NULL
  for (i in 1:n.blocks) {
    all.blocks = bind_rows(all.blocks, single.block)
  }
  
  # Correctly label day of trial and treatment blocks
  all.blocks = all.blocks %>% 
    mutate(
      block = rep(1:n.blocks, each = s.freq * p.length * length(order)),
      day = rep(1:(n.blocks * p.length * length(order)), each = s.freq)
    )
  
  return(all.blocks)
}

a = create.backbone(s.freq = 1, p.length = 2, n.blocks = 2)
```

```{r}
order = c("A", "B")
s.freq = 2
p.length = 2
n.blocks = 2
day = rep(1:(n.blocks * p.length * length(order)), each = s.freq)
```


